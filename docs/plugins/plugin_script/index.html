<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <title>Plugin Script | home</title>

    <style>body{margin:40px auto;max-width:650px;line-height:1.6;font-size:18px;color:#444;padding:0 10px}h1,h2,h3{line-height:1.2}div.header h1{padding-top:0;padding-bottom:8px;margin-bottom:24px;font-size:18px;font-weight:400;border-bottom:1px solid}.header-menu{float:right}ul.pagination{list-style-type:none;text-align:center;padding:0}ul.pagination>li{padding:0 8px;display:inline-block}div.footer{border-top:1px solid;text-align:center}img{max-width:100%;max-height:100%;display:block;margin-left:auto;margin-right:auto}</style>

    <link rel="stylesheet" href="/wash/custom.css">
<link href="https://fonts.googleapis.com/css?family=IBM+Plex+Mono:400,500" rel="stylesheet"> 
<link href="https://fonts.googleapis.com/css?family=Comfortaa|Monoton|Merriweather" rel="stylesheet"> 

</head>

<body>
<div class="header">
    <h1>
        <a href="/wash">home</a>
        <div class="header-menu">
            <a href="/wash/plugins">plugins</a>
            <a href="/wash/api">api</a>
            <a href="/wash/#">news</a>
            <a href="https://github.com/puppetlabs/wash">github</a>
            <a href="https://github.com/puppetlabs/wash/releases">download</a>
            <a href="https://puppetcommunity.slack.com/app_redirect?channel=wash">slack</a>
        </div>
    </h1>
</div>
<div id="content">

<header>
    <h1>Plugin Script</h1>
    

<div class="post-meta">
    
</div>
</header>
<article>
    

<p>Wash shells out to the external plugin&rsquo;s script whenever it needs to invoke an action on one of its entries. The script must have the following usage:</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;plugin_script&gt; &lt;action&gt; &lt;path&gt; &lt;state&gt; &lt;args...&gt;</pre></td></tr></table>
</div>
</div>
<p>where</p>

<ul>
<li><code>&lt;action&gt;</code> is the Wash action that&rsquo;s being invoked</li>
<li><code>&lt;path&gt;</code> is the entry&rsquo;s filesystem path relative to Wash&rsquo;s mountpoint</li>
<li><code>&lt;state&gt;</code> consists of the minimum amount of information required to reconstruct the entry inside the plugin</li>
<li><code>&lt;args...&gt;</code> are the arguments passed to the specific action.</li>
</ul>

<p><code>&lt;path&gt;</code> and <code>&lt;state&gt;</code> can be a bit confusing. To understand them, we recommend reading the <a href="#aside">Aside</a>, and to look at the provided <a href="examples/sshfs.sh">Bash</a> + Ruby external plugin examples to see how they&rsquo;re used. <strong>TODO: Link a Ruby example</strong></p>

<p>The remaining sections describe all possible values of <code>&lt;action&gt;</code> that can be passed-in, including each action&rsquo;s calling and error conventions, and the expected results.</p>

<h2 id="init">init</h2>

<p>The <code>init</code> action is special. It is invoked as <code>&lt;plugin_script&gt; init</code>, and it is invoked only once, when the external plugin is loaded. When <code>init</code> is invoked, the script must output a JSON object representing the plugin root. Here&rsquo;s an example:</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">6
</span></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">{
  &#34;name&#34;: &#34;aws&#34;,
  &#34;supported_actions&#34;: [
    &#34;list&#34;
  ]
}</pre></td></tr></table>
</div>
</div>
<p>This example shows the <em>minimum</em> amount of information required for Wash to construct the plugin root. In fact, the example shows the minimum amount of information required for Wash to construct <em>any</em> external plugin entry. This information consists of the entry&rsquo;s name and its supported actions.</p>

<p>You can include additional keys in the printed JSON object. These keys are:</p>

<ul>
<li><code>cache_ttls</code>. This specifies how many seconds each supported action&rsquo;s result should be cached (<code>ttl</code> is short for time to live).</li>
<li><code>attributes</code>. This represents the entry&rsquo;s filesystem attributes, if any. These are the access time <code>atime</code>, last modified time <code>mtime</code>, creation time <code>ctime</code>, mode <code>mode</code>, and size <code>size</code>. The individual time attributes are specified in Unix seconds. Octal modes must be prefixed with the <code>0</code> delimiter (e.g. like <code>0777</code>). Hexadecimal modes must be prefixed with the <code>0x</code> delimiter (e.g. like <code>0xabcd</code>).</li>
<li><code>state</code>. This corresponds to the <code>&lt;state&gt;</code> parameter in the plugin script&rsquo;s usage.</li>
</ul>

<p>Below is an example JSON object showcasing all possible keys at once.</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">{
  &#34;name&#34;: &#34;some_entry&#34;,
  &#34;supported_actions&#34;: [
    &#34;list&#34;
  ],
  &#34;cache_ttls&#34;: {
    &#34;list&#34;: 30
  },
  &#34;attributes&#34;: {
    &#34;atime&#34;: 1551942012,
    &#34;mtime&#34;: 1551942012,
    &#34;ctime&#34;: 1551942012,
    &#34;mode&#34;: 511,
    &#34;size&#34;: 15600
  },
  &#34;state&#34;: &#34;{\&#34;klass\&#34;:\&#34;AWS::Profile\&#34;}&#34;
}</pre></td></tr></table>
</div>
</div>
<p>We see from <code>cache_ttls</code> that the result of <code>some_entry</code>&rsquo;s <code>list</code> action will be cached for 30 seconds. We see from <code>attributes</code> that <code>some_entry</code> has some filesystem attributes that are defined (note that the mode is <code>0777</code>; <code>511</code> is its Base-10 representation). Finally, we see from <code>state</code> that <code>some_entry</code> has some state that Wash will pass-back in via the <code>&lt;state&gt;</code> parameter whenever it invokes one of its supported actions. In this case, only <code>list</code> is supported, and <code>&lt;state&gt;</code> is a stringified JSON object containing the entry&rsquo;s class (<code>AWS::Profile</code>) in whatever language the plugin script was written in.</p>

<p>The <code>init</code> action adopts the standard error conventions described in the <a href="#errors">Errors</a> section.</p>

<h2 id="list">list</h2>

<p>The <code>list</code> action is invoked as <code>&lt;plugin_script&gt; list &lt;path&gt; &lt;state&gt;</code>. When <code>list</code> is invoked, the script must output an array of JSON objects. Each JSON object has the same schema as the JSON object described in the <code>init</code> section (hence, <code>list</code> outputs an array of entries). Below is an example of valid output from the <code>list</code> action.</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 4
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 5
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 6
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 7
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 8
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f"> 9
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">10
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">11
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">12
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">13
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">14
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">15
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">16
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">17
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">18
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">19
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">20
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">21
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">22
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">23
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">24
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">25
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">26
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">27
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">28
</span></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">[
	{
		&#34;name&#34;: &#34;LARGE_FILE.txt&#34;,
		&#34;supported_actions&#34;: [
			&#34;metadata&#34;,
			&#34;read&#34;,
			&#34;stream&#34;
		],
		&#34;attributes&#34;: {
			&#34;Mtime&#34;: 1551459978,
			&#34;Size&#34;: 100000000
		},
		&#34;state&#34;: &#34;{\&#34;name\&#34;:\&#34;LARGE_FILE.txt\&#34;,\&#34;profile\&#34;:\&#34;default\&#34;,\&#34;region\&#34;:\&#34;us-west-1\&#34;,\&#34;bucket\&#34;:\&#34;my-stupid-bucket-enis\&#34;,\&#34;attributes\&#34;:{\&#34;Mtime\&#34;:1551459978,\&#34;Size\&#34;:100000000},\&#34;klass\&#34;:\&#34;S3Object\&#34;}&#34;
	},
	{
		&#34;name&#34;: &#34;my_json_file.json&#34;,
		&#34;supported_actions&#34;: [
			&#34;metadata&#34;,
			&#34;read&#34;,
			&#34;stream&#34;
		],
		&#34;attributes&#34;: {
			&#34;Mtime&#34;: 1549572670,
			&#34;Size&#34;: 9336
		},
		&#34;state&#34;: &#34;{\&#34;name\&#34;:\&#34;my_json_file.json\&#34;,\&#34;profile\&#34;:\&#34;default\&#34;,\&#34;region\&#34;:\&#34;us-west-1\&#34;,\&#34;bucket\&#34;:\&#34;my-stupid-bucket-enis\&#34;,\&#34;attributes\&#34;:{\&#34;Mtime\&#34;:1549572670,\&#34;Size\&#34;:9336},\&#34;klass\&#34;:\&#34;S3Object\&#34;}&#34;
	}
]</pre></td></tr></table>
</div>
</div>
<p><strong>NOTE:</strong> Remember that the state displayed here is the same <code>&lt;state&gt;</code> parameter that will be passed in to other actions invoked on that entry. For example, if the <code>read</code> action is invoked on <code>LARGE_FILE.txt</code> via <code>&lt;plugin_script&gt; read &lt;parent_path&gt;/LARGE_FILE.txt &lt;state&gt;</code>, then the value of <code>LARGE_FILE.txt</code>&rsquo;s <code>state</code> key will be passed-in for <code>&lt;state&gt;</code>.</p>

<p>The <code>list</code> action adopts the standard error convention described in the <a href="#errors">Errors</a> section.</p>

<h2 id="read">read</h2>

<p>The <code>read</code> action is invoked as <code>&lt;plugin_script&gt; read &lt;path&gt; &lt;state&gt;</code>. When <code>read</code> is invoked, the script must output the entry&rsquo;s content.</p>

<p>The <code>read</code> action adopts the standard error convention described in the <a href="#errors">Errors</a> section.</p>

<h2 id="metadata">metadata</h2>

<p>The <code>metadata</code> action is invoked as <code>&lt;plugin_script&gt; metadata &lt;path&gt; &lt;state&gt;</code>. When <code>metadata</code> is invoked, the script must output a JSON object representing the entry&rsquo;s metadata. Below is an example of acceptable <code>metadata</code> output:</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">2
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">3
</span><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">4
</span></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">{
  &#34;key1&#34;: &#34;value1&#34;,
  &#34;key2&#34;: &#34;value2&#34;
}</pre></td></tr></table>
</div>
</div>
<p>The <code>metadata</code> action adopts the standard error convention described in the <a href="#errors">Errors</a> section.</p>

<h2 id="stream">stream</h2>

<p>The <code>stream</code> action is invoked as <code>&lt;plugin_script&gt; stream &lt;path&gt; &lt;state&gt;</code>. When <code>stream</code> is invoked, the first line of the script&rsquo;s output must contain the <code>200</code> header. This header tells Wash that the entry&rsquo;s data is about to the streamed. After it outputs the header, the script must then stream the entry&rsquo;s data. Wash will continue to poll stdout for any updates until either the streaming process exits, or the user cancels the request. In the latter case, Wash will send the <code>SIGTERM</code> signal to the streaming process.</p>

<p>The <code>stream</code> action adopts the standard error convention described in the <a href="#errors">Errors</a> section.</p>

<h2 id="exec">exec</h2>

<p>The <code>exec</code> action is invoked as <code>&lt;plugin_script&gt; exec &lt;path&gt; &lt;state&gt; &lt;cmd&gt; &lt;args...&gt;</code>. If the <code>input</code> key is included as part of <code>opts</code> in a request to the <code>exec</code> endpoint, then its content is passed-in as stdin to the plugin script. When <code>exec</code> is invoked, the plugin script&rsquo;s stdout and stderr must be connected to <code>cmd</code>&rsquo;s stdout and stderr, and it must exit the <code>exec</code> invocation with <code>cmd</code>&rsquo;s exit code.</p>

<p>Because the <code>exec</code> action effectively hijacks <code>&lt;plugin_script&gt; exec</code> with <code>&lt;cmd&gt; &lt;args...&gt;</code>, there is currently no way for external plugins to report any <code>exec</code> errors to Wash. Thus, if <code>&lt;plugin_script&gt; exec</code> fails to exec <code>&lt;cmd&gt; &lt;args...&gt;</code> (e.g. due to a failed API call to trigger the exec), then that error output will be included as part of <code>&lt;cmd&gt; &lt;args...&gt;</code>&rsquo;s output when running <code>wash exec</code>.</p>

<h2 id="errors-a-name-errors-a">Errors <a name="errors"></a></h2>

<p>All errors are printed to <code>stderr</code>. An action invocation is said to have errored when the plugin script returns a non-zero exit code. In that case, Wash wraps all of <code>stderr</code> into an error object, then documents that error in the process&rsquo; activity and the server logs.</p>

<p><strong>NOTE:</strong> Not all actions adopt this error handling convention (e.g. <code>exec</code>). The error handling for these &ldquo;snowflake&rdquo; actions is described in their respective sections.</p>

<h2 id="aside-optional-a-name-aside-a">Aside (optional)<a name="aside"></a></h2>

<p>This section talks about the reasoning behind the plugin script&rsquo;s usage, shown below for convenience:</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;plugin_script&gt; &lt;action&gt; &lt;path&gt; &lt;state&gt; &lt;args...&gt;</pre></td></tr></table>
</div>
</div>
<p>If we let <code>&lt;entry&gt; = &lt;path&gt; &lt;state&gt;</code>, then our usage becomes:</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;plugin_script&gt; &lt;action&gt; &lt;entry&gt; &lt;args...&gt;</pre></td></tr></table>
</div>
</div>
<p>If we ignore <code>&lt;plugin_script&gt;</code> then the above turns into <code>&lt;action&gt; &lt;entry&gt; &lt;args...&gt;</code>. When read out loud, this looks like the function call <code>&lt;action&gt;(&lt;entry&gt;, &lt;args...&gt;)</code>. If we imagine <code>&lt;entry&gt;</code> as an object in an OOP language, this is semantically equivalent to:</p>
<div class="highlight"><div style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">
<table style="border-spacing:0;padding:0;margin:0;border:0;width:auto;overflow:auto;display:block;"><tr><td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><span style="margin-right:0.4em;padding:0 0.4em 0 0.4em;color:#7f7f7f">1
</span></pre></td>
<td style="vertical-align:top;padding:0;margin:0;border:0;">
<pre style="background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4">&lt;entry&gt;.&lt;action&gt;(&lt;args...&gt;)</pre></td></tr></table>
</div>
</div>
<p>For example, if <code>&lt;entry&gt; = myS3Bucket</code>, <code>&lt;action&gt; = list</code>, and <code>&lt;args...&gt;</code> is empty, then we can read the above as <code>myS3Bucket.list()</code>. Thus, the plugin script&rsquo;s usage can be thought of as invoking an action (<code>&lt;action&gt;</code>) on the specified entry (<code>&lt;path&gt; &lt;state&gt;</code>) with the given arguments (<code>&lt;args...&gt;</code>).</p>

<p>You might be wondering why we don&rsquo;t just lump <code>&lt;path&gt;</code> and <code>&lt;state&gt;</code> together into <code>&lt;entry&gt;</code> so that the plugin script&rsquo;s usage becomes <code>&lt;plugin_script&gt; &lt;action&gt; &lt;entry&gt; &lt;args...&gt;</code>. There&rsquo;s several reasons. One, having the <code>&lt;path&gt;</code> is helpful for debugging purposes. You can directly see the acting entry in the logs, which frees you from having to figure that information out yourself. Two, it mirrors the API&rsquo;s structure of <code>/fs/&lt;action&gt;/&lt;path&gt;</code>. And three, sometimes the <code>&lt;path&gt;</code> is all you need to write your plugin script. While you could always print the <code>&lt;path&gt;</code> yourself and make that the <code>&lt;state&gt;</code> parameter for Wash to pass around, it can be annoying to have to constantly do that, especially when you&rsquo;re writing simple plugins. Thus, <code>&lt;path&gt;</code> is really more of a convenience. You should use <code>&lt;path&gt;</code> if that&rsquo;s what you need to write your plugin. Otherwise, if you&rsquo;re writing a more complicated plugin that needs to maintain some state (e.g. like the entry&rsquo;s class name and its constructor arguments), then use <code>&lt;state&gt;</code>. However, try to avoid using <code>&lt;path&gt;</code> and <code>&lt;state&gt;</code> together in the same plugin script, as doing so can make it hard to reason about your code. Use either <code>&lt;path&gt;</code> or <code>&lt;state&gt;</code>, but not both.</p>

<p><strong>NOTE:</strong> The <code>init</code> action is special. Its usage is <code>&lt;plugin_script&gt; init</code> &ndash; there is no <code>&lt;path&gt;</code> or <code>&lt;state</code>&gt; so there is no <code>&lt;entry&gt;</code>. Thus, the OOP call of <code>&lt;entry&gt;.&lt;action&gt;(&lt;args...&gt;)</code> doesn&rsquo;t make sense for <code>init</code>. So how do you reason about it? Why do we have an <code>init</code> action? Since every Wash plugin is modeled as a filesystem, it must have a root. Once we know the root, then it is easy to get to a specific entry by repeatedly invoking the <code>list</code> action. The <code>init</code> action is how you describe that &lsquo;root&rsquo;.</p>

</article>


    </div>
<div class="footer">
    
    

    
    
    <div class="copyright">© 2019 — the wash maintainers</div>
    
</div>
</body>

</html>